[platformio]
default_envs = multi_4ch
src_dir = ./src
build_dir = ./build

[common]
platform = espressif32@6.4.0
framework = arduino
board = esp32dev
board_build.partitions = default.csv
monitor_speed = 115200
upload_speed = 460800

# Common build flags for multi-channel controller
build_flags =
    -D ARDUINO_ARCH_ESP32
    -D CONFIG_ASYNC_TCP_RUNNING_CORE=1
    # WLED Features
    -D WLED_ENABLE_WEBSOCKETS
    -D WLED_ENABLE_MQTT
    -D WLED_ENABLE_ADALIGHT
    -D WLED_DISABLE_HUESYNC
    # Multi-segment support
    -D WLED_MAX_BUSSES=8
    -D WLED_MAX_SEGMENTS=16
    # Auto-save settings
    -D USERMOD_AUTO_SAVE
    # Default LED type
    -D DEFAULT_LED_TYPE=TYPE_WS2812_RGB
    -D LED_COLOR_ORDER_GRB

# Common libraries
lib_deps =
    https://github.com/Aircoookie/WLED.git#v0.14.0
    fastled/FastLED@^3.6.0
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git

# ====================================
# 4-Channel Basic Configuration
# ====================================
[env:multi_4ch]
board = esp32dev
build_flags =
    ${common.build_flags}
    # Channel configuration
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    # LEDs per channel
    -D DEFAULT_LED_COUNT_CH1=300
    -D DEFAULT_LED_COUNT_CH2=300
    -D DEFAULT_LED_COUNT_CH3=300
    -D DEFAULT_LED_COUNT_CH4=300
    # Total power budget (60A @ 5V)
    -D WLED_MAX_CURRENT=60000
    -D DEFAULT_BRIGHTNESS=128
lib_deps =
    ${common.lib_deps}

# ====================================
# 4-Channel with Smaller LEDs (150 per channel)
# ====================================
[env:multi_4ch_150led]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D DEFAULT_LED_COUNT_CH1=150
    -D DEFAULT_LED_COUNT_CH2=150
    -D DEFAULT_LED_COUNT_CH3=150
    -D DEFAULT_LED_COUNT_CH4=150
    -D WLED_MAX_CURRENT=30000          # 30A total
    -D DEFAULT_BRIGHTNESS=150
lib_deps =
    ${common.lib_deps}

# ====================================
# 6-Channel Configuration
# ====================================
[env:multi_6ch]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=6
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D LEDPIN_CH5=17
    -D LEDPIN_CH6=18
    -D DEFAULT_LED_COUNT_CH1=200
    -D DEFAULT_LED_COUNT_CH2=200
    -D DEFAULT_LED_COUNT_CH3=200
    -D DEFAULT_LED_COUNT_CH4=200
    -D DEFAULT_LED_COUNT_CH5=200
    -D DEFAULT_LED_COUNT_CH6=200
    -D WLED_MAX_CURRENT=60000
    -D DEFAULT_BRIGHTNESS=128
lib_deps =
    ${common.lib_deps}

# ====================================
# 8-Channel Configuration
# ====================================
[env:multi_8ch]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=8
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D LEDPIN_CH5=17
    -D LEDPIN_CH6=18
    -D LEDPIN_CH7=19
    -D LEDPIN_CH8=21
    -D DEFAULT_LED_COUNT_CH1=150
    -D DEFAULT_LED_COUNT_CH2=150
    -D DEFAULT_LED_COUNT_CH3=150
    -D DEFAULT_LED_COUNT_CH4=150
    -D DEFAULT_LED_COUNT_CH5=150
    -D DEFAULT_LED_COUNT_CH6=150
    -D DEFAULT_LED_COUNT_CH7=150
    -D DEFAULT_LED_COUNT_CH8=150
    -D WLED_MAX_CURRENT=60000
    -D DEFAULT_BRIGHTNESS=128
lib_deps =
    ${common.lib_deps}

# ====================================
# 4-Channel with WS2815 (12V LEDs)
# ====================================
[env:multi_4ch_ws2815]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D DEFAULT_LED_COUNT_CH1=500      # 12V allows longer runs
    -D DEFAULT_LED_COUNT_CH2=500
    -D DEFAULT_LED_COUNT_CH3=500
    -D DEFAULT_LED_COUNT_CH4=500
    -D DEFAULT_LED_TYPE=TYPE_WS2815
    -D WLED_MAX_CURRENT=40000          # 12V = lower current
    -D DEFAULT_BRIGHTNESS=150
lib_deps =
    ${common.lib_deps}

# ====================================
# Commercial Installation (Mixed Channels)
# ====================================
[env:multi_commercial]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=6
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D LEDPIN_CH5=17
    -D LEDPIN_CH6=18
    # Mixed LED counts for different zones
    -D DEFAULT_LED_COUNT_CH1=400      # Main perimeter
    -D DEFAULT_LED_COUNT_CH2=400
    -D DEFAULT_LED_COUNT_CH3=200      # Accent zones
    -D DEFAULT_LED_COUNT_CH4=200
    -D DEFAULT_LED_COUNT_CH5=150      # Detail zones
    -D DEFAULT_LED_COUNT_CH6=150
    -D WLED_MAX_CURRENT=75000          # 75A for large commercial
    -D DEFAULT_BRIGHTNESS=150
    -D USERMOD_AUTO_SAVE
    -D AUTO_SAVE_INTERVAL_SEC=1800     # Save every 30min
lib_deps =
    ${common.lib_deps}

# ====================================
# Architectural Installation
# ====================================
[env:multi_architectural]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=8
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D LEDPIN_CH5=17
    -D LEDPIN_CH6=18
    -D LEDPIN_CH7=19
    -D LEDPIN_CH8=21
    # Each channel = building facade
    -D DEFAULT_LED_COUNT_CH1=300
    -D DEFAULT_LED_COUNT_CH2=300
    -D DEFAULT_LED_COUNT_CH3=250
    -D DEFAULT_LED_COUNT_CH4=250
    -D DEFAULT_LED_COUNT_CH5=200
    -D DEFAULT_LED_COUNT_CH6=200
    -D DEFAULT_LED_COUNT_CH7=150
    -D DEFAULT_LED_COUNT_CH8=150
    -D WLED_MAX_CURRENT=90000          # 90A for large buildings
    -D DEFAULT_BRIGHTNESS=180
    -D USERMOD_AUTO_SAVE
lib_deps =
    ${common.lib_deps}

# ====================================
# Debug Build
# ====================================
[env:multi_debug]
board = esp32dev
build_type = debug
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D DEFAULT_LED_COUNT_CH1=100      # Smaller for testing
    -D DEFAULT_LED_COUNT_CH2=100
    -D DEFAULT_LED_COUNT_CH3=100
    -D DEFAULT_LED_COUNT_CH4=100
    -D WLED_MAX_CURRENT=20000
    -D CORE_DEBUG_LEVEL=5
    -D DEBUG_ESP_PORT=Serial
    -D WLED_DEBUG
monitor_filters = esp32_exception_decoder
lib_deps =
    ${common.lib_deps}

# ====================================
# OTA Update
# ====================================
[env:multi_ota]
board = esp32dev
upload_protocol = espota
upload_port = wled-multi.local
upload_flags =
    --port=3232
    --auth=wledota
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D DEFAULT_LED_COUNT_CH1=300
    -D DEFAULT_LED_COUNT_CH2=300
    -D DEFAULT_LED_COUNT_CH3=300
    -D DEFAULT_LED_COUNT_CH4=300
    -D WLED_MAX_CURRENT=60000
lib_deps =
    ${common.lib_deps}

# ====================================
# ESP32-S3 (PSRAM, High Performance)
# ====================================
[env:multi_s3]
board = esp32-s3-devkitc-1
board_build.arduino.memory_type = qio_opi
build_flags =
    ${common.build_flags}
    -D BOARD_HAS_PSRAM
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D CHANNEL_COUNT=8
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D LEDPIN_CH5=17
    -D LEDPIN_CH6=18
    -D LEDPIN_CH7=19
    -D LEDPIN_CH8=21
    # More LEDs with PSRAM
    -D DEFAULT_LED_COUNT_CH1=400
    -D DEFAULT_LED_COUNT_CH2=400
    -D DEFAULT_LED_COUNT_CH3=400
    -D DEFAULT_LED_COUNT_CH4=400
    -D DEFAULT_LED_COUNT_CH5=400
    -D DEFAULT_LED_COUNT_CH6=400
    -D DEFAULT_LED_COUNT_CH7=400
    -D DEFAULT_LED_COUNT_CH8=400
    -D WLED_MAX_CURRENT=120000         # 120A for massive installations
lib_deps =
    ${common.lib_deps}

# ====================================
# Test Build (Minimal LEDs)
# ====================================
[env:multi_test]
board = esp32dev
build_flags =
    ${common.build_flags}
    -D CHANNEL_COUNT=4
    -D LEDPIN_CH1=2
    -D LEDPIN_CH2=4
    -D LEDPIN_CH3=15
    -D LEDPIN_CH4=16
    -D DEFAULT_LED_COUNT_CH1=10       # Just 10 LEDs per channel for testing
    -D DEFAULT_LED_COUNT_CH2=10
    -D DEFAULT_LED_COUNT_CH3=10
    -D DEFAULT_LED_COUNT_CH4=10
    -D WLED_MAX_CURRENT=2000           # USB-powered safe
    -D DEFAULT_BRIGHTNESS=200
lib_deps =
    ${common.lib_deps}
